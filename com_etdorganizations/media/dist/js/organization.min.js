/**!
 * @package     @etd-framework/etdorganizations
 *
 * @version     1.0.4
 * @copyright   Copyright (C) 2017 - 2018 ETD Solutions. Tous droits réservés.
 * @license     GNU General Public License v3 
 * @author      ETD Solutions http://etd-solutions.com
*/
jQuery(function(a){window.editContact=function(b,c,d){var e=a("#contact-"+b);if(0===e.length){var f="";f+='<div class="thumbnail" id="contact-'+b+'">',f+='<input type="hidden" name="jform[contacts][]" value="'+b+'">',void 0!==d&&d.length&&(f+='<div class="img" style="background-image:url('+d+');"></div>'),f+='<div class="caption"><h3>'+c+"</h3>",f+='<p><a href="index.php?option=com_etdorganizations&view=contact&tmpl=component&layout=edit&id='+b+'" class="modal btn" title="Modifier" rel="{handler: \'iframe\', size: {x: 800, y: 500}}"><span class="icon-apply"></span>Modifier</a>',f+='&nbsp;<a href="#" class="btn btn-remove" role="button" data-id="'+b+'"><span class="icon-cancel"></span>Effacer</a>',f+='&nbsp;<a href="#" class="btn btn-delete" role="button" data-id="'+b+'"><span class="icon-trash"></span>Supprimer</a></p>',f+="</div></div>",a("#contact-thumbnails").append(f),SqueezeBox.assign(a("#contact-"+b+" a.modal").get(),{parse:"rel"})}else e.find(".caption h3").text(c),void 0!==d?d.length&&(e.find(".img").length>0?e.find(".img").css("background-image","url("+d+")"):e.prepend('<div class="img" style="background-image:url('+d+');"></div>')):e.find(".img").remove()},window.processModalEdit=function(a,b,c,d,e,f,g,h){f=f||d.toLowerCase()+"-form",g=g||"jform_id",h=h||"jform_title";var i=a.parentNode.parentNode.id,j=e;jQuery("#"+i+" iframe").get(0).id="Frame_"+i;var k=jQuery("#Frame_"+i).contents().get(0);return"cancel"===e?(document.getElementById("Frame_"+i).contentWindow.Joomla.submitbutton(d.toLowerCase()+"."+e),jQuery("#"+i).modal("hide")):(jQuery("#Frame_"+i).on("load",function(){k=jQuery(this).contents().get(0),k.getElementById(g)&&"0"!=k.getElementById(g).value&&(window.editContact(k.getElementById(g).value,k.getElementById(h).value),"save"===e&&window.processModalEdit(a,b,"edit",d,"cancel",f,g,h)),jQuery("#"+i+" iframe").removeClass("hidden")}),k.formvalidator.isValid(k.getElementById(f))&&("save"===e&&(j="apply"),document.getElementById("Frame_"+i).contentWindow.Joomla.submitbutton(d.toLowerCase()+"."+j))),!1},window.processModalSelect=function(a,b,c,d,e,f,g,h){return window.editContact(c,d),jQuery("#ModalSelect"+a+"_"+b).modal("hide").modal("clear"),!1},Joomla.submitbutton=function(a){("organization.cancel"===a||document.formvalidator.isValid(document.getElementById("organization-form")))&&Joomla.submitform(a,document.getElementById("organization-form"))},a(document).ready(function(){a(document).on("click",".btn-remove",function(){var b=a(this).data("id");a("#contact-"+b).remove()}),a(document).on("click",".btn-delete",function(){var b=a(this).data("id");a.ajax({url:"index.php?option=com_etdorganizations&task=contact.ajaxDelete&id="+b,type:"POST"}).done(function(c){a("#contact-"+b).remove()}).fail(function(a){alert("La fiche contact n'a pas pu être supprimée.")})})})});
